---
// Hero section for 1Panel website
import { Icon } from "astro-icon/components";
// 获取下载量数据
let downloadCount = 1500000; // 默认值

try {
  const response = await fetch(
    "https://community.fit2cloud.com/installation-statistics?product=OnePanel&dateRange=AllTime"
  );
  const count = await response.text();
  downloadCount = parseInt(count) || 1500000;
} catch (error) {
  console.error("Failed to fetch download count:", error);
}

// 格式化下载量显示
function formatDownloadCount(count: number): { display: number; unit: string } {
  if (count >= 1000000) {
    return { display: Math.floor(count / 100000) / 10, unit: "M+" };
  } else if (count >= 1000) {
    return { display: Math.floor(count / 100) / 10, unit: "k+" };
  }
  return { display: count, unit: "" };
}

const formattedDownload = formatDownloadCount(downloadCount);
---

<section
  id="home"
  class="relative min-h-screen flex items-center overflow-hidden bg-gray-50"
>
  <!-- Floating Geometric Shapes -->
  <div class="absolute inset-0 overflow-hidden">
    <div
      class="absolute top-20 left-10 w-20 h-20 rounded-full blur-2xl animate-float bg-1panel opacity-20"
    >
    </div>
    <div
      class="absolute top-40 right-20 w-32 h-32 rounded-full blur-2xl animate-float bg-1panel opacity-30"
      style="animation-delay: -2s;"
    >
    </div>
    <div
      class="absolute bottom-20 left-20 w-24 h-24 rounded-full blur-2xl animate-float bg-1panel opacity-40"
      style="animation-delay: -4s;"
    >
    </div>
    <div
      class="absolute bottom-40 right-10 w-16 h-16 rounded-full blur-2xl animate-float bg-1panel opacity-60"
      style="animation-delay: -6s;"
    >
    </div>
  </div>

  <!-- Main Content -->
  <div class="relative z-10 container-custom py-20">
    <div
      id="hero-content"
      class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center min-h-[80vh]"
    >
      <!-- Left Content -->
      <div
        id="hero-left"
        class="transition-all duration-1000"
      >
        <!-- Main Heading -->
        <h1
          class="fade-in-up text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6"
          style="animation-delay: 0.2s;"
        >
          <span class="block text-gray-800 mb-2">使用 1Panel</span>
          <span class="block text-1panel-gradient">
            轻松管理 <span id="typewriter-text" class="typing-effect">应用</span
            >
          </span>
        </h1>

        <!-- Badges -->
        <div
          class="fade-in-up flex flex-wrap gap-3 mb-6"
          style="animation-delay: 0.3s;"
        >
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200"
          >
            <svg
              class="w-4 h-4 mr-1.5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            现代化
          </span>
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200"
          >
            <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
              ></path>
            </svg>
            开源
          </span>
        </div>

        <!-- Subtitle -->
        <p
          class="fade-in-up text-lg md:text-xl text-gray-600 mb-8 leading-relaxed"
          style="animation-delay: 0.4s;"
        >
          1Panel 提供了一个直观的 Web 界面，帮助用户轻松管理 Linux
          服务器中的应用、网站、文件、数据库以及大语言模型（LLMs）等。
        </p>

        <!-- Statistics -->
        <div
          class="fade-in-up grid grid-cols-2 gap-6 mb-8"
          style="animation-delay: 0.6s;"
        >
          <div class="text-center lg:text-left">
            <div
              class="text-3xl font-bold counter text-1panel"
              data-target="29500"
            >
              0
            </div>
            <div
              class="text-gray-500 text-sm mt-1 flex items-center justify-center lg:justify-start"
            >
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                ></path>
              </svg>
              GitHub Stars
            </div>
          </div>
          <div class="text-center lg:text-left">
            <div
              class="text-3xl font-bold counter text-1panel"
              data-target={downloadCount.toString()}
            >
              {formattedDownload.display}{formattedDownload.unit}
            </div>
            <div
              class="text-gray-500 text-sm mt-1 flex items-center justify-center lg:justify-start"
            >
              <svg
                class="w-4 h-4 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                ></path>
              </svg>
              累计安装次数
            </div>
          </div>
        </div>

        <!-- Quick Install Section -->
        <div class="fade-in-up" style="animation-delay: 0.8s;">
          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-4">
            <a
              href="https://demo.1panel.cn/"
              target="_blank"
              class="btn-primary text-lg px-8 py-4 group inline-flex items-center justify-center"
            >
              在线体验
              <Icon name="carbon:link" class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform duration-300" />
            </a>
            <a
              href="#quickstart"
              target="_blank"
              class="btn-secondary text-lg px-8 py-4 group inline-flex items-center justify-center"
            >
              免费安装
              <Icon name="carbon:download" class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform duration-300" />
            </a>
          </div>
        </div>
      </div>
      <!-- Right Content - Dashboard Preview -->
      <div id="hero-right" class="transition-all duration-1000">
        <div
          class="fade-in-right relative hero-dashboard-preview"
          style="animation-delay: 0.5s;"
        >
          <!-- Dashboard Image -->
          <div class="relative">
            <div
              class="relative bg-white rounded-lg border border-gray-200 overflow-hidden shadow-2xl"
            >
              <div class="relative">
                <div class="relative z-10">
                  <a
                href="https://www.bilibili.com/video/BV1Mt421n7LZ/"
                target="_blank"
                rel="noopener noreferrer"
                class="relative w-full"
                style="outline: none;"
                aria-label="播放视频"
              >
                  <img
                    src="./images/overview-full.png"
                    alt="1Panel 现代化界面"
                    class="w-full h-auto rounded-lg shadow-2xl border border-gray-200"
                  />
                  <span
                  class="absolute inset-0 flex items-center justify-center pointer-events-none"
                  style="z-index: 2;"
                >
                  <Icon name="carbon:play-outline-filled" class="w-20 h-20 md:w-24 md:h-24 text-gray-300 animate-pulse" />
                </span>
                </a>
                </div>
                <div class="absolute inset-0 bg-gradient-to-tr from-blue-100 to-transparent rounded-lg -rotate-6 scale-105 opacity-30"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll Indicator -->
  <div
    class="absolute bottom-8 left-1/2 transform -translate-x-1/2 text-center flex flex-col items-center"
  >
    <div class="text-gray-500 text-sm mb-2">向下滚动</div>
    <div
      class="w-6 h-10 border-2 border-gray-400 rounded-full flex justify-center"
    >
      <div class="w-1 h-3 rounded-full mt-2 animate-bounce bg-1panel"></div>
    </div>
  </div>
</section>

<style>
  .typing-effect::after {
    content: "|";
    animation: blink 1s infinite;
  }

  #typewriter-text {
    display: inline-block;
  }
</style>

<script>
  // 打字机效果
  document.addEventListener("DOMContentLoaded", function () {
    const texts = [
      "应用",
      "网站",
      "文件",
      "数据库",
      "容器",
      "大模型",
      "MCP 服务",
    ];

    const typewriterElement = document.getElementById("typewriter-text");
    if (!typewriterElement) return; // 如果元素不存在则退出

    let currentTextIndex = 0;
    let currentCharIndex = 0;
    let isDeleting = false;
    let typeSpeed = 100; // 打字速度
    let deleteSpeed = 100; // 删除速度
    let pauseTime = 2000; // 每个词停留时间

    function typeWriter() {
      const element = document.getElementById("typewriter-text");
      if (!element) return;

      const currentText = texts[currentTextIndex];

      if (isDeleting) {
        // 删除字符
        element.textContent = currentText.substring(0, currentCharIndex - 1);
        currentCharIndex--;

        if (currentCharIndex === 0) {
          isDeleting = false;
          currentTextIndex = (currentTextIndex + 1) % texts.length;
          setTimeout(typeWriter, 500); // 删除完后短暂停顿
          return;
        }
        setTimeout(typeWriter, deleteSpeed);
      } else {
        // 添加字符
        element.textContent = currentText.substring(0, currentCharIndex + 1);
        currentCharIndex++;

        if (currentCharIndex === currentText.length) {
          setTimeout(() => {
            isDeleting = true;
            typeWriter();
          }, pauseTime); // 显示完整文本后停顿
          return;
        }
        setTimeout(typeWriter, typeSpeed);
      }
    }

    // 延迟启动，等待fade-in动画完成
    setTimeout(typeWriter, 1000);
  });

  // 复制安装命令功能
  document.addEventListener("DOMContentLoaded", function () {
    const copyButton = document.getElementById("copy-install-cmd");
    const installCommand =
      'bash -c "$(curl -sSL https://resource.fit2cloud.com/1panel/package/v2/quick_start.sh)"';

    if (copyButton) {
      const originalContent = copyButton.innerHTML;

      copyButton.addEventListener("click", async function () {
        try {
          await navigator.clipboard.writeText(installCommand);

          // 更新按钮状态
          copyButton.innerHTML = `
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            已复制
          `;
          copyButton.classList.add("text-1panel");

          // 2秒后恢复原状
          setTimeout(() => {
            copyButton.innerHTML = originalContent;
            copyButton.classList.remove("text-1panel");
          }, 2000);
        } catch (err) {
          console.error("复制失败:", err);
          // 降级处理：选中文本
          const textArea = document.createElement("textarea");
          textArea.value = installCommand;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand("copy");
            copyButton.innerHTML = `
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              已复制
            `;
            setTimeout(() => {
              copyButton.innerHTML = originalContent;
            }, 2000);
          } catch (fallbackErr) {
            console.error("降级复制也失败:", fallbackErr);
          }
          document.body.removeChild(textArea);
        }
      });
    }
  });
</script>
